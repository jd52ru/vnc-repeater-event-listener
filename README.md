# VNC Repeater Event Listener

–°–∏—Å—Ç–µ–º–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VNC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ UltraVNC Repeater —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ VNC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UltraVNC Repeater
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–ª—É–∂–±—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ noVNC –¥–ª—è –≤–µ–±-–¥–æ—Å—Ç—É–ø–∞ –∫ VNC —Å–µ—Å—Å–∏—è–º

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Linux (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å –Ω–∞ RedOS8)
- Python 3.8+
- g++ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä
- make
- –î–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç—É 80 (–¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/jd52ru/vnc-repeater-event-listener.git
cd vnc-repeater-event-listener
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤

**–î–ª—è RedOS:**
```bash
sudo yum update
sudo yum install -y python3 python3-venv gcc-c++ make git
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Python
python3 --version

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞
g++ --version

# –ü—Ä–æ–≤–µ—Ä–∫–∞ make
make --version
```

### 3. –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
sudo ./scripts/install.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫:**
- –°–æ–∑–¥–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 'uvncrep'
- –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç UltraVNC Repeater –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞
- –°–æ–∑–¥–∞–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ Python
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- –°–æ–∑–¥–∞–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–ª—É–∂–±—ã
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–í–æ –≤—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–∞—Å —Å–ø—Ä–æ—Å—è—Ç:**
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–∞ 80

## –î–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
http://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä-ip
```

**–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∫–ª—é—á–∞–µ—Ç:**
- üìä –î–∞—à–±–æ—Ä–¥ —Å –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- üîÑ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω—ã—Ö VNC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- üìù –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–±—ã—Ç–∏–π
- üñ•Ô∏è –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π noVNC –∫–ª–∏–µ–Ω—Ç –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Å—Å–∏—è–º

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª—É–∂–±–∞–º–∏

### Event Listener (–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)

```bash
# –ó–∞–ø—É—Å–∫ —Å–ª—É–∂–±—ã
sudo systemctl start uvnc-event-listener

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–ª—É–∂–±—ã
sudo systemctl stop uvnc-event-listener

# –°—Ç–∞—Ç—É—Å —Å–ª—É–∂–±—ã
sudo systemctl status uvnc-event-listener

# –í–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
sudo systemctl enable uvnc-event-listener

# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
sudo systemctl disable uvnc-event-listener

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
sudo journalctl -u uvnc-event-listener -f

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ª–æ–≥–æ–≤
sudo journalctl -u uvnc-event-listener -n 50
```

### UltraVNC Repeater

```bash
# –ó–∞–ø—É—Å–∫ —Å–ª—É–∂–±—ã
sudo systemctl start uvncrepeater

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–ª—É–∂–±—ã
sudo systemctl stop uvncrepeater

# –°—Ç–∞—Ç—É—Å —Å–ª—É–∂–±—ã
sudo systemctl status uvncrepeater

# –í–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
sudo systemctl enable uvncrepeater

# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
sudo systemctl disable uvncrepeater

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
sudo journalctl -u uvncrepeater -f

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ª–æ–≥–æ–≤
sudo journalctl -u uvncrepeater -n 50
```

## –£–¥–∞–ª–µ–Ω–∏–µ

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
sudo ./scripts/uninstall.sh
```

**–í–æ –≤—Ä–µ–º—è —É–¥–∞–ª–µ–Ω–∏—è –≤–∞—Å —Å–ø—Ä–æ—Å—è—Ç –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:**
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ '/etc/uvnc/'
- –§–∞–π–ª–æ–≤ –ª–æ–≥–æ–≤ –≤ '/var/log/uvnc/'
- –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ '/tmp/'
- –°–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 'uvncrep'
- –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è Python
- –§–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞

**–ë—ã—Å—Ç—Ä–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (–±–µ–∑ –∑–∞–ø—Ä–æ—Å–æ–≤):**
```bash
sudo ./scripts/uninstall.sh <<< $'y\ny\ny\ny\ny\ny\n'
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ú–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –≤ —Å–∏—Å—Ç–µ–º–µ:

**1. –ò–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:**
- –û–±–µ —Å–ª—É–∂–±—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ–¥ –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º 'uvncrep'
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è namespaces –∏ private tmp

**2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∞–≤:**
- Event Listener –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 'CAP_NET_BIND_SERVICE' –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ root –¥–æ—Å—Ç—É–ø–∞
- –ó–∞–ø—Ä–µ—â–µ–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π ('NoNewPrivileges=yes')
- –°—Ç—Ä–æ–≥–∞—è –∑–∞—â–∏—Ç–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ ('ProtectSystem=strict')

**3. –°–µ—Ç–µ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- UltraVNC Repeater –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è —Ç–æ–ª—å–∫–æ –Ω–∞ localhost (127.0.0.1)
- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ø–æ HTTP (–ø–æ—Ä—Ç 80)
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏ —Å HTTPS –¥–ª—è production

**4. –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞:**
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –¥–æ–º–∞—à–Ω–∏–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º ('ProtectHome=yes')
- –†–∞–∑—Ä–µ—à–µ–Ω—ã –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É—Å–∏–ª–µ–Ω–∏—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä–∞ (firewalld)
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --permanent --add-port=5500/tcp
sudo firewall-cmd --permanent --add-port=5900/tcp
sudo firewall-cmd --reload

# –ò–ª–∏ –¥–ª—è iptables
sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 5500 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 5900 -j ACCEPT
```

## –õ–æ–≥–∏

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ (journalctl)

```bash
# –í—Å–µ –ª–æ–≥–∏ Event Listener
sudo journalctl -u uvnc-event-listener

# –í—Å–µ –ª–æ–≥–∏ UltraVNC Repeater
sudo journalctl -u uvncrepeater

# –õ–æ–≥–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
sudo journalctl -u uvnc-event-listener --since "1 hour ago"

# –õ–æ–≥–∏ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –¥–∞—Ç—ã
sudo journalctl -u uvncrepeater --since "2024-01-01" --until "2024-01-02"

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
sudo journalctl -u uvnc-event-listener -f
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

### –ï—Å–ª–∏ —Å–ª—É–∂–±—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status uvnc-event-listener
sudo systemctl status uvncrepeater

# –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏
sudo journalctl -u uvnc-event-listener -xe
sudo journalctl -u uvncrepeater -xe

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
sudo netstat -tlnp | grep :80
sudo netstat -tlnp | grep :5500
sudo netstat -tlnp | grep :5900
```

### –ï—Å–ª–∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Firewall
sudo firewall-cmd --list-all

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–∞
curl -I http://localhost

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª—É–∂–±—ã
sudo systemctl status uvnc-event-listener
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

- '/etc/uvnc/uvncrepeater.ini' - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è UltraVNC Repeater
- '/etc/systemd/system/uvnc-event-listener.service' - —Å–ª—É–∂–±–∞ Event Listener
- '/etc/systemd/system/uvncrepeater.service' - —Å–ª—É–∂–±–∞ UltraVNC Repeater

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä—Ç–æ–≤:

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ—Ä—Ç—ã:
- **80** - –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Event Listener
- **5500** - UltraVNC Repeater (—Å–µ—Ä–≤–µ—Ä—ã)
- **5900** - UltraVNC Repeater (–∫–ª–∏–µ–Ω—Ç—ã)
